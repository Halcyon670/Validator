
2016-10-01 14:49:32.380822: Successfully purged prior log and started a new one.
2016-10-01 14:49:43.360245: Moving forward with the following docs: ['36e420872-14e9e7e47e8']
2016-10-01 14:49:43.621444: Checking 36e420872-14e9e7e47e8 (IVB Rated Daily Theo Win per Slot (visits=2), AV_I01):
	Query: SELECT VBB2__Aggregates.Bank AS Bank,VBB2__Aggregates.CabinetType AS CabinetType,VBB2__Aggregates.Denom AS Denom,VBB2__Aggregates.DisplayType AS DisplayType,VBB2__Aggregates.GameType AS GameType,VBB2__Aggregates.Location AS Location,VBB2__Aggregates.Manufacturer AS Manufacturer,VBB2__Aggregates.Mnum AS Mnum,VBB2__Aggregates.Paylines AS Paylines,VBB2__Aggregates.Reels AS Reels,VBB2__Aggregates.Section AS Section,VBB2__Aggregates.Theme AS Theme,VBB2__Spatials.Latitude AS Latitude,VBB2__Spatials.Longitude AS Longitude,VBB2__Aggregates.Chairs_Standid AS Chairs_Standid,VBB2__Aggregates.Chairs_Standid_SCD_Start AS Chairs_Standid_SCD_Start,VBB2__Aggregates.Chairs_Standid_SCD_End AS Chairs_Standid_SCD_End,VBB2__Aggregates.Chairs_Standid_SCD_History AS Chairs_Standid_SCD_History,VBB2__Aggregates.Chairs_Standid_SCD_Changed AS Chairs_Standid_SCD_Changed,VBB2__Aggregates.Slot_StandID AS Slot_StandID,VBB2__Aggregates.Slot_StandID_SCD_Start AS Slot_StandID_SCD_Start,VBB2__Aggregates.Slot_StandID_SCD_End AS Slot_StandID_SCD_End,VBB2__Aggregates.Slot_StandID_SCD_History AS Slot_StandID_SCD_History,VBB2__Aggregates.Slot_StandID_SCD_Changed AS Slot_StandID_SCD_Changed,VBB2__Aggregates.ActualHold AS ActualHold,VBB2__Aggregates.ActualWin AS ActualWin,VBB2__Aggregates.ActualWinperDay AS ActualWinperDay,VBB2__Aggregates.AvgBet AS AvgBet,VBB2__Aggregates.CoinIn AS CoinIn,VBB2__Aggregates.CoinInperDay AS CoinInperDay,VBB2__Aggregates.DaysonFloor AS DaysonFloor,VBB2__Aggregates.Freeplay AS Freeplay,VBB2__Aggregates.FreePlayperDay AS FreePlayperDay,VBB2__Aggregates.GamesPlayed AS GamesPlayed,VBB2__Aggregates.GamesPlayedperDay AS GamesPlayedperDay,VBB2__Aggregates.GamesPlayedPerMinute AS GamesPlayedPerMinute,VBB2__Aggregates.HoldVariance AS HoldVariance,VBB2__Aggregates.HoursPlayed AS HoursPlayed,VBB2__Aggregates.HoursPlayedperDay AS HoursPlayedperDay,VBB2__Aggregates.Jackpot AS Jackpot,VBB2__Aggregates.Occupancy AS Occupancy,VBB2__Aggregates.PlayerCount AS PlayerCount,VBB2__Aggregates.TheoHold AS TheoHold,VBB2__Aggregates.TheoWin AS TheoWin,VBB2__Aggregates.TheoWinperDay AS TheoWinperDay,VBB2__Aggregates.TheoWinperHour AS TheoWinperHour FROM (SELECT CRMDemo.dbo.BIS2_V_Slot_Location_SCD.Bank AS Bank,CRMDemo.dbo.BIS2_VW_Slot_Names.CabinetType AS CabinetType,CRMDemo.dbo.BIS2_GEO_chairs.ogc_fid AS VBB2__kf_Chairs_ogc,CRMDemo.dbo.BIS2_VW_Slot_Names.Denom AS Denom,CRMDemo.dbo.BIS2_VW_Slot_Names.Cabinet AS DisplayType,CRMDemo.dbo.BIS2_VW_Slot_Names.GameType AS GameType,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.Location AS Location,CRMDemo.dbo.BIS2_VW_Slot_Names.MFR AS Manufacturer,CRMDemo.dbo.BIS2_VW_Slot_Names.mnum AS Mnum,CRMDemo.dbo.BIS2_VW_Slot_Names.Paylines AS Paylines,CRMDemo.dbo.BIS2_VW_Slot_Names.Reels AS Reels,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.Section AS Section,CRMDemo.dbo.BIS2_VW_Slot_Names.Description AS Theme,CRMDemo.dbo.BIS2_GEO_chairs.standid AS Chairs_Standid,CRMDemo.dbo.BIS2_GEO_chairs.startgd AS Chairs_Standid_SCD_Start,CRMDemo.dbo.BIS2_GEO_chairs.endgd AS Chairs_Standid_SCD_End,CRMDemo.dbo.BIS2_GEO_chairs.version AS Chairs_Standid_SCD_Version,CASE WHEN(datepart(year,CRMDemo.dbo.BIS2_GEO_chairs.startgd)*10000+datepart(mm,CRMDemo.dbo.BIS2_GEO_chairs.startgd)*100+datepart(dd,CRMDemo.dbo.BIS2_GEO_chairs.startgd))-(datepart(year,'20130214')*10000+datepart(mm,'20130214')*100+datepart(dd,'20130214'))<0 AND (datepart(year,'20130214')*10000+datepart(mm,'20130214')*100+datepart(dd,'20130214'))-(datepart(year,CRMDemo.dbo.BIS2_GEO_chairs.endgd)*10000+datepart(mm,CRMDemo.dbo.BIS2_GEO_chairs.endgd)*100+datepart(dd,CRMDemo.dbo.BIS2_GEO_chairs.endgd))<=0 THEN 0 ELSE 1 END AS Chairs_Standid_SCD_History,CASE WHEN((CRMDemo.dbo.BIS2_GEO_chairs.startgd < '20130214' AND CRMDemo.dbo.BIS2_GEO_chairs.startgd >= '20130201') OR (CRMDemo.dbo.BIS2_GEO_chairs.endgd < '20130214' AND CRMDemo.dbo.BIS2_GEO_chairs.endgd >= '20130201'))THEN 1 ELSE 0 END AS Chairs_Standid_SCD_Changed,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid AS Slot_StandID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AS Slot_StandID_SCD_Start,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate AS Slot_StandID_SCD_End,CASE WHEN(datepart(year,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate)*10000+datepart(mm,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate)*100+datepart(dd,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate))-(datepart(year,'20130214')*10000+datepart(mm,'20130214')*100+datepart(dd,'20130214'))<0 AND (datepart(year,'20130214')*10000+datepart(mm,'20130214')*100+datepart(dd,'20130214'))-(datepart(year,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate)*10000+datepart(mm,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate)*100+datepart(dd,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate))<=0 THEN 0 ELSE 1 END AS Slot_StandID_SCD_History,CASE WHEN((CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate < '20130214' AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate >= '20130201') OR (CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate < '20130214' AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate >= '20130201'))THEN 1 ELSE 0 END AS Slot_StandID_SCD_Changed,case when SUM(BIS2_VW_PlayerSession.coinin) <> 0 then (SUM(BIS2_VW_PlayerSession.win)/SUM(BIS2_VW_PlayerSession.coinin))*100.0 else 0 end AS ActualHold,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin,case when COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar))<>0 then sum(BIS2_VW_PlayerSession.win)/COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar)) else 0 end AS ActualWinperDay,case when SUM(BIS2_VW_PlayerSession.Games)<>0 THEN SUM(BIS2_VW_PlayerSession.Coinin)/SUM(BIS2_VW_PlayerSession.Games) ELSE 0 END AS AvgBet,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.CoinIn) AS CoinIn,case when COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar))<>0 then sum(BIS2_VW_PlayerSession.coinin)/COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar)) else 0 end AS CoinInperDay,COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar)) AS DaysonFloor,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.FreePlay) AS Freeplay,case when COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar))<>0 then sum(BIS2_VW_PlayerSession.freeplay)/COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar)) else 0 end AS FreePlayperDay,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Games) AS GamesPlayed,case when COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar))<>0 then sum(BIS2_VW_PlayerSession.games)/COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar)) else 0 end AS GamesPlayedperDay,MAX(BIS2_SQLTC_Occupancy.GamesPlayedPerMinute) AS GamesPlayedPerMinute,case when SUM(BIS2_VW_PlayerSession.coinin) <> 0 then (SUM(BIS2_VW_PlayerSession.win)-SUM(BIS2_VW_PlayerSession.theowin))/SUM(BIS2_VW_PlayerSession.coinin)*100.0 else 0 end AS HoldVariance,SUM(BIS2_VW_PlayerSession.TimePlayed / 3600.0) AS HoursPlayed,case when COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar))<>0 then sum(BIS2_VW_PlayerSession.timeplayed/3600)/COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar)) else 0 end AS HoursPlayedperDay,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Jackpot) AS Jackpot,MAX(BIS2_SQLTC_Occupancy.Occupancy) AS Occupancy,COUNT(DISTINCT BIS2_VW_PlayerSession.PlayerID) AS PlayerCount,case when SUM(BIS2_VW_PlayerSession.coinin) <> 0 then (SUM(BIS2_VW_PlayerSession.theowin)/SUM(BIS2_VW_PlayerSession.coinin))*100.0 else 0 end AS TheoHold,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin,case when COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar))<>0 then sum(BIS2_VW_PlayerSession.theowin)/COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar)) else 0 end AS TheoWinperDay,MAX(BIS2_SQLTC_Occupancy.TheoWinPerHour) AS TheoWinperHour FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_VW_Game_Comb_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.Location = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.standid) LEFT JOIN CRMDemo.dbo.BIS2_VW_Slot_Names ON (CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid = CRMDemo.dbo.BIS2_VW_Slot_Names.SiteID AND CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.mnum = CRMDemo.dbo.BIS2_VW_Slot_Names.mnum) INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID INNER JOIN CRMDemo.dbo.BIS2_V_Slot_Location_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.MNUM = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate) INNER JOIN CRMDemo.dbo.BIS2_GEO_chairs ON (CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid = CRMDemo.dbo.BIS2_GEO_chairs.standid AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid = CRMDemo.dbo.BIS2_GEO_chairs.casinoid) INNER JOIN (/* SqlTableCalculator: BIS2_SQLTC_Occupancy*/SELECT BIS2_SQLTC_RatedMetrics.Mnum AS Mnum,BIS2_SQLTC_UnratedMetrics.Mnum_Location AS Mnum_Location,BIS2_SQLTC_RatedMetrics.SiteID AS SiteID,BIS2_SQLTC_RatedMetrics.StandID AS StandID,BIS2_SQLTC_RatedMetrics.startdate AS startdate,BIS2_SQLTC_RatedMetrics.GamesPlayedPerMinute AS GamesPlayedPerMinute,CASE WHEN BIS2_SQLTC_RatedMetrics.GamesPlayedperHour/24.0 <> 0 THEN   100.0*BIS2_SQLTC_UnRatedMetrics.GamesPlayedperDay/BIS2_SQLTC_RatedMetrics.GamesPlayedperHour/24.0 ELSE 0 END AS Occupancy,BIS2_SQLTC_RatedMetrics.TheoWinperHour AS TheoWinperHour FROM (/* SqlTableCalculator: BIS2_SQLTC_RatedMetrics*/SELECT CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AS Mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AS SiteID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid AS StandID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AS startdate,CASE WHEN SUM(BIS2_VW_PlayerSession.TimePlayed/3600.0) <> 0 THEN  SUM(BIS2_VW_PlayerSession.Games)/(SUM(BIS2_VW_PlayerSession.TimePlayed/3600.0)) ELSE 0 END AS GamesPlayedPerHour,CASE WHEN SUM(BIS2_VW_PlayerSession.TimePlayed/60.0) <> 0 THEN  SUM(BIS2_VW_PlayerSession.Games)/(SUM(BIS2_VW_PlayerSession.TimePlayed/60.0)) ELSE 0 END AS GamesPlayedPerMinute,COUNT(DISTINCT BIS2_VW_PlayerSession.PlayerID) AS PlayerCount,CASE WHEN SUM(BIS2_VW_PlayerSession.TimePlayed) <> 0 THEN SUM(BIS2_VW_PlayerSession.TheoWin) /   (SUM(BIS2_VW_PlayerSession.TimePlayed)/3600.00) ELSE 0 END AS TheoWinperHour FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID INNER JOIN CRMDemo.dbo.BIS2_V_Slot_Location_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.MNUM = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate) INNER HASH JOIN (/* SqlTableCalculator: BIS2_SQLTC_PlayerSummary*/SELECT MAX(BIS2_VW_PlayerSession.GamingDate) AS LastDaywithPlay,CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID AS PlayerID,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN 100.0*SUM(BIS2_VW_PlayerSession.Win)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS ActualWinTheoWinRatio,Case WHEN count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) <> 0 THEN  sum(BIS2_VW_PlayerSession.TheoWin)/count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) ELSE 0 END AS ADT,Sum(BIS2_VW_PlayerSession.TheoWin)/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMT,cast(count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) as decimal(10,4))/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMV,datediff(dd,max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),MAX(BIS2_FN_SGStartEndDate.SGEndDate)) AS DaysSinceLastTrip,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN (SUM(BIS2_VW_PlayerSession.Freeplay)*100.0)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS FreeplayReinvestmentPct,CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then  datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end AS MeanTimeBetweenTrips,CASE WHEN SUM(case when GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)<>0 THEN (100.0*(SUM(case when   GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)-SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)))/SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END) ELSE 0 END AS PercentChangeTheoWin,CASE WHEN COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)<>0 THEN   (100.0*(COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)-   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)))/   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END) ELSE 0 END AS PercentChangeVisits,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin,CASE WHEN CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end <>0 THEN  datediff(dd,  max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),  MAX(BIS2_FN_SGStartEndDate.SGEndDate))/CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end ELSE 0 END AS TripsOwed,case when cast(DATEDIFF(dd,max(BIS2_VW_PlayerSession.GamingDate),min(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2)) <> 0 then  (count(distinct BIS2_VW_PlayerSession.GamingDate)-1)/cast(DATEDIFF(dd,min(BIS2_VW_PlayerSession.GamingDate),max(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2))  ELSE 0 END AS VisitDensity,count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) AS Visits FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_FN_SGStartEndDate('20130201 00:00:00','20130214 00:00:00') AS BIS2_FN_SGStartEndDate ON CRMDemo.dbo.BIS2_VW_PlayerSession.hackjoin = BIS2_FN_SGStartEndDate.HackJoin INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID WHERE ((CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')) GROUP BY CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID/* End: BIS2_SQLTC_PlayerSummary*/) AS BIS2_SQLTC_PlayerSummary ON CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID = BIS2_SQLTC_PlayerSummary.PlayerID WHERE ((CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S') AND (BIS2_SQLTC_PlayerSummary.Visits = 2)) GROUP BY CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate/* End: BIS2_SQLTC_RatedMetrics*/) AS BIS2_SQLTC_RatedMetrics INNER JOIN (/* SqlTableCalculator: BIS2_SQLTC_UnratedMetrics*/SELECT CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AS Mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.Mnum_Location AS Mnum_Location,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AS SiteID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid AS StandID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AS startdate,case when count(distinct cast(bis2_vw_perioddetail.standid as varchar)+cast( dbo.BIS2_VW_PeriodDetail.date as varchar))<>0 then sum(BIS2_VW_PeriodDetail.MtrGames)/count(distinct cast(bis2_vw_perioddetail.standid as varchar)+cast( dbo.BIS2_VW_PeriodDetail.date as varchar))else 0 END AS GamesPlayedperDay FROM CRMDemo.dbo.BIS2_VW_PeriodDetail INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PeriodDetail.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID INNER JOIN CRMDemo.dbo.BIS2_V_Slot_Location_SCD ON (CRMDemo.dbo.BIS2_VW_PeriodDetail.SiteID = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PeriodDetail.Mnum = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AND CRMDemo.dbo.BIS2_VW_PeriodDetail.Date >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AND CRMDemo.dbo.BIS2_VW_PeriodDetail.Date < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate) WHERE ((CRMDemo.dbo.BIS2_VW_PeriodDetail.Date >= '20130201') AND (CRMDemo.dbo.BIS2_VW_PeriodDetail.Date < '20130214') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB')) GROUP BY CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.Mnum_Location,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate/* End: BIS2_SQLTC_UnratedMetrics*/) AS BIS2_SQLTC_UnratedMetrics ON (BIS2_SQLTC_RatedMetrics.SiteID = BIS2_SQLTC_UnratedMetrics.SiteID AND BIS2_SQLTC_RatedMetrics.Mnum = BIS2_SQLTC_UnratedMetrics.Mnum AND BIS2_SQLTC_RatedMetrics.StandID = BIS2_SQLTC_UnratedMetrics.StandID AND BIS2_SQLTC_RatedMetrics.startdate = BIS2_SQLTC_UnratedMetrics.startdate)/* End: BIS2_SQLTC_Occupancy*/) AS BIS2_SQLTC_Occupancy ON (CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid = BIS2_SQLTC_Occupancy.SiteID AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum = BIS2_SQLTC_Occupancy.Mnum AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid = BIS2_SQLTC_Occupancy.StandID AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate = BIS2_SQLTC_Occupancy.startdate) INNER HASH JOIN (/* SqlTableCalculator: BIS2_SQLTC_PlayerSummary*/SELECT MAX(BIS2_VW_PlayerSession.GamingDate) AS LastDaywithPlay,CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID AS PlayerID,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN 100.0*SUM(BIS2_VW_PlayerSession.Win)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS ActualWinTheoWinRatio,Case WHEN count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) <> 0 THEN  sum(BIS2_VW_PlayerSession.TheoWin)/count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) ELSE 0 END AS ADT,Sum(BIS2_VW_PlayerSession.TheoWin)/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMT,cast(count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) as decimal(10,4))/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMV,datediff(dd,max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),MAX(BIS2_FN_SGStartEndDate.SGEndDate)) AS DaysSinceLastTrip,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN (SUM(BIS2_VW_PlayerSession.Freeplay)*100.0)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS FreeplayReinvestmentPct,CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then  datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end AS MeanTimeBetweenTrips,CASE WHEN SUM(case when GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)<>0 THEN (100.0*(SUM(case when   GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)-SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)))/SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END) ELSE 0 END AS PercentChangeTheoWin,CASE WHEN COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)<>0 THEN   (100.0*(COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)-   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)))/   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END) ELSE 0 END AS PercentChangeVisits,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin,CASE WHEN CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end <>0 THEN  datediff(dd,  max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),  MAX(BIS2_FN_SGStartEndDate.SGEndDate))/CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end ELSE 0 END AS TripsOwed,case when cast(DATEDIFF(dd,max(BIS2_VW_PlayerSession.GamingDate),min(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2)) <> 0 then  (count(distinct BIS2_VW_PlayerSession.GamingDate)-1)/cast(DATEDIFF(dd,min(BIS2_VW_PlayerSession.GamingDate),max(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2))  ELSE 0 END AS VisitDensity,count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) AS Visits FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_FN_SGStartEndDate('20130201 00:00:00','20130214 00:00:00') AS BIS2_FN_SGStartEndDate ON CRMDemo.dbo.BIS2_VW_PlayerSession.hackjoin = BIS2_FN_SGStartEndDate.HackJoin INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID WHERE ((CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')) GROUP BY CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID/* End: BIS2_SQLTC_PlayerSummary*/) AS BIS2_SQLTC_PlayerSummary ON CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID = BIS2_SQLTC_PlayerSummary.PlayerID WHERE ((CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S') AND (BIS2_SQLTC_PlayerSummary.Visits = 2) AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_GEO_chairs.startgd) AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_GEO_chairs.endgd) AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate) AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate)) GROUP BY CRMDemo.dbo.BIS2_V_Slot_Location_SCD.Bank,CRMDemo.dbo.BIS2_VW_Slot_Names.CabinetType,CRMDemo.dbo.BIS2_GEO_chairs.ogc_fid,CRMDemo.dbo.BIS2_VW_Slot_Names.Denom,CRMDemo.dbo.BIS2_VW_Slot_Names.Cabinet,CRMDemo.dbo.BIS2_VW_Slot_Names.GameType,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.Location,CRMDemo.dbo.BIS2_VW_Slot_Names.MFR,CRMDemo.dbo.BIS2_VW_Slot_Names.mnum,CRMDemo.dbo.BIS2_VW_Slot_Names.Paylines,CRMDemo.dbo.BIS2_VW_Slot_Names.Reels,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.Section,CRMDemo.dbo.BIS2_VW_Slot_Names.Description,CRMDemo.dbo.BIS2_GEO_chairs.standid,CRMDemo.dbo.BIS2_GEO_chairs.startgd,CRMDemo.dbo.BIS2_GEO_chairs.endgd,CRMDemo.dbo.BIS2_GEO_chairs.version,CASE WHEN(datepart(year,CRMDemo.dbo.BIS2_GEO_chairs.startgd)*10000+datepart(mm,CRMDemo.dbo.BIS2_GEO_chairs.startgd)*100+datepart(dd,CRMDemo.dbo.BIS2_GEO_chairs.startgd))-(datepart(year,'20130214')*10000+datepart(mm,'20130214')*100+datepart(dd,'20130214'))<0 AND (datepart(year,'20130214')*10000+datepart(mm,'20130214')*100+datepart(dd,'20130214'))-(datepart(year,CRMDemo.dbo.BIS2_GEO_chairs.endgd)*10000+datepart(mm,CRMDemo.dbo.BIS2_GEO_chairs.endgd)*100+datepart(dd,CRMDemo.dbo.BIS2_GEO_chairs.endgd))<=0 THEN 0 ELSE 1 END,CASE WHEN((CRMDemo.dbo.BIS2_GEO_chairs.startgd < '20130214' AND CRMDemo.dbo.BIS2_GEO_chairs.startgd >= '20130201') OR (CRMDemo.dbo.BIS2_GEO_chairs.endgd < '20130214' AND CRMDemo.dbo.BIS2_GEO_chairs.endgd >= '20130201'))THEN 1 ELSE 0 END,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate,CASE WHEN(datepart(year,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate)*10000+datepart(mm,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate)*100+datepart(dd,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate))-(datepart(year,'20130214')*10000+datepart(mm,'20130214')*100+datepart(dd,'20130214'))<0 AND (datepart(year,'20130214')*10000+datepart(mm,'20130214')*100+datepart(dd,'20130214'))-(datepart(year,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate)*10000+datepart(mm,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate)*100+datepart(dd,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate))<=0 THEN 0 ELSE 1 END,CASE WHEN((CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate < '20130214' AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate >= '20130201') OR (CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate < '20130214' AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate >= '20130201'))THEN 1 ELSE 0 END) AS VBB2__Aggregates INNER JOIN (SELECT CRMDemo.dbo.BIS2_GEO_chairs.ogc_fid AS VBB2__kf_Chairs_ogc,CRMDemo.dbo.BIS2_GEO_chairs.wkt_geo AS Latitude,CRMDemo.dbo.BIS2_GEO_chairs.wkt_geo AS Longitude FROM CRMDemo.dbo.BIS2_GEO_chairs) AS VBB2__Spatials ON VBB2__Aggregates.VBB2__kf_Chairs_ogc = VBB2__Spatials.VBB2__kf_Chairs_ogc ORDER BY Chairs_Standid,Chairs_Standid_SCD_History,Chairs_Standid_SCD_Start DESC,Slot_StandID,Slot_StandID_SCD_History,Slot_StandID_SCD_Start DESC
	DocAggs: ['ActualHold', 'ActualWin', 'ActualWinperDay', 'AvgBet', 'CoinIn', 'CoinInperDay', 'DaysonFloor', 'Freeplay', 'FreePlayperDay', 'GamesPlayed', 'GamesPlayedperDay', 'HoldVariance', 'HoursPlayed', 'HoursPlayedperDay', 'Jackpot', 'PlayerCount', 'TheoHold', 'TheoWin', 'TheoWinperDay']
	DocAggDict: {'TheoHold': 'SUM(BIS2_VW_PlayerSession.coinin) <> 0 then (SUM(BIS2_VW_PlayerSession.theowin)/SUM(BIS2_VW_PlayerSession.coinin))*100.0 else 0 end AS TheoHold', 'CoinInperDay': 'COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar))<>0 then sum(BIS2_VW_PlayerSession.coinin)/COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar)) else 0 end AS CoinInperDay', 'GamesPlayedperDay': 'COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar))<>0 then sum(BIS2_VW_PlayerSession.games)/COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar)) else 0 end AS GamesPlayedperDay', 'Freeplay': 'SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.FreePlay) AS Freeplay', 'ActualWin': 'SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin', 'TheoWin': 'SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin', 'AvgBet': 'SUM(BIS2_VW_PlayerSession.Games)<>0 THEN SUM(BIS2_VW_PlayerSession.Coinin)/SUM(BIS2_VW_PlayerSession.Games) ELSE 0 END AS AvgBet', 'DaysonFloor': 'COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar)) AS DaysonFloor', 'GamesPlayed': 'SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Games) AS GamesPlayed', 'CoinIn': 'SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.CoinIn) AS CoinIn', 'PlayerCount': 'COUNT(DISTINCT BIS2_VW_PlayerSession.PlayerID) AS PlayerCount', 'HoursPlayed': 'SUM(BIS2_VW_PlayerSession.TimePlayed / 3600.0) AS HoursPlayed', 'HoldVariance': 'SUM(BIS2_VW_PlayerSession.coinin) <> 0 then (SUM(BIS2_VW_PlayerSession.win)-SUM(BIS2_VW_PlayerSession.theowin))/SUM(BIS2_VW_PlayerSession.coinin)*100.0 else 0 end AS HoldVariance', 'FreePlayperDay': 'COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar))<>0 then sum(BIS2_VW_PlayerSession.freeplay)/COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar)) else 0 end AS FreePlayperDay', 'ActualWinperDay': 'COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar))<>0 then sum(BIS2_VW_PlayerSession.win)/COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar)) else 0 end AS ActualWinperDay', 'TheoWinperDay': 'COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar))<>0 then sum(BIS2_VW_PlayerSession.theowin)/COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar)) else 0 end AS TheoWinperDay', 'HoursPlayedperDay': 'COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar))<>0 then sum(BIS2_VW_PlayerSession.timeplayed/3600)/COUNT(DISTINCT cast(BIS2_VW_PlayerSession.GamingDate as varchar)+cast(BIS2_VW_PlayerSession.Location as varchar)) else 0 end AS HoursPlayedperDay', 'Jackpot': 'SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Jackpot) AS Jackpot', 'ActualHold': 'SUM(BIS2_VW_PlayerSession.coinin) <> 0 then (SUM(BIS2_VW_PlayerSession.win)/SUM(BIS2_VW_PlayerSession.coinin))*100.0 else 0 end AS ActualHold'}
	DocJoins: ['CRMDemo.dbo.BIS2_VW_PlayerSession', 'CRMDemo.dbo.BIS2_VW_Game_Comb_SCD', 'CRMDemo.dbo.BIS2_VW_Slot_Names', 'CRMDemo.dbo.BIS2_VW_Site', 'CRMDemo.dbo.BIS2_V_Slot_Location_SCD', 'CRMDemo.dbo.BIS2_GEO_chairs', 'BIS2_SQLTC_Occupancy', 'BIS2_SQLTC_PlayerSummary']DocJoinDict: {'CRMDemo.dbo.BIS2_VW_Site': 'INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID ', 'BIS2_SQLTC_Occupancy': "INNER JOIN (/* SqlTableCalculator: BIS2_SQLTC_Occupancy*/SELECT BIS2_SQLTC_RatedMetrics.Mnum AS Mnum,BIS2_SQLTC_UnratedMetrics.Mnum_Location AS Mnum_Location,BIS2_SQLTC_RatedMetrics.SiteID AS SiteID,BIS2_SQLTC_RatedMetrics.StandID AS StandID,BIS2_SQLTC_RatedMetrics.startdate AS startdate,BIS2_SQLTC_RatedMetrics.GamesPlayedPerMinute AS GamesPlayedPerMinute,CASE WHEN BIS2_SQLTC_RatedMetrics.GamesPlayedperHour/24.0 <> 0 THEN   100.0*BIS2_SQLTC_UnRatedMetrics.GamesPlayedperDay/BIS2_SQLTC_RatedMetrics.GamesPlayedperHour/24.0 ELSE 0 END AS Occupancy,BIS2_SQLTC_RatedMetrics.TheoWinperHour AS TheoWinperHour FROM (/* SqlTableCalculator: BIS2_SQLTC_RatedMetrics*/SELECT CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AS Mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AS SiteID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid AS StandID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AS startdate,CASE WHEN SUM(BIS2_VW_PlayerSession.TimePlayed/3600.0) <> 0 THEN  SUM(BIS2_VW_PlayerSession.Games)/(SUM(BIS2_VW_PlayerSession.TimePlayed/3600.0)) ELSE 0 END AS GamesPlayedPerHour,CASE WHEN SUM(BIS2_VW_PlayerSession.TimePlayed/60.0) <> 0 THEN  SUM(BIS2_VW_PlayerSession.Games)/(SUM(BIS2_VW_PlayerSession.TimePlayed/60.0)) ELSE 0 END AS GamesPlayedPerMinute,COUNT(DISTINCT BIS2_VW_PlayerSession.PlayerID) AS PlayerCount,CASE WHEN SUM(BIS2_VW_PlayerSession.TimePlayed) <> 0 THEN SUM(BIS2_VW_PlayerSession.TheoWin) /   (SUM(BIS2_VW_PlayerSession.TimePlayed)/3600.00) ELSE 0 END AS TheoWinperHour FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID INNER JOIN CRMDemo.dbo.BIS2_V_Slot_Location_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.MNUM = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate) INNER HASH JOIN (/* SqlTableCalculator: BIS2_SQLTC_PlayerSummary*/SELECT MAX(BIS2_VW_PlayerSession.GamingDate) AS LastDaywithPlay,CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID AS PlayerID,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN 100.0*SUM(BIS2_VW_PlayerSession.Win)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS ActualWinTheoWinRatio,Case WHEN count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) <> 0 THEN  sum(BIS2_VW_PlayerSession.TheoWin)/count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) ELSE 0 END AS ADT,Sum(BIS2_VW_PlayerSession.TheoWin)/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMT,cast(count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) as decimal(10,4))/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMV,datediff(dd,max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),MAX(BIS2_FN_SGStartEndDate.SGEndDate)) AS DaysSinceLastTrip,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN (SUM(BIS2_VW_PlayerSession.Freeplay)*100.0)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS FreeplayReinvestmentPct,CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then  datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end AS MeanTimeBetweenTrips,CASE WHEN SUM(case when GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)<>0 THEN (100.0*(SUM(case when   GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)-SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)))/SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END) ELSE 0 END AS PercentChangeTheoWin,CASE WHEN COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)<>0 THEN   (100.0*(COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)-   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)))/   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END) ELSE 0 END AS PercentChangeVisits,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin,CASE WHEN CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end <>0 THEN  datediff(dd,  max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),  MAX(BIS2_FN_SGStartEndDate.SGEndDate))/CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end ELSE 0 END AS TripsOwed,case when cast(DATEDIFF(dd,max(BIS2_VW_PlayerSession.GamingDate),min(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2)) <> 0 then  (count(distinct BIS2_VW_PlayerSession.GamingDate)-1)/cast(DATEDIFF(dd,min(BIS2_VW_PlayerSession.GamingDate),max(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2))  ELSE 0 END AS VisitDensity,count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) AS Visits FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_FN_SGStartEndDate('20130201 00:00:00','20130214 00:00:00') AS BIS2_FN_SGStartEndDate ON CRMDemo.dbo.BIS2_VW_PlayerSession.hackjoin = BIS2_FN_SGStartEndDate.HackJoin INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID WHERE ((CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')) GROUP BY CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID/* End: BIS2_SQLTC_PlayerSummary*/) AS BIS2_SQLTC_PlayerSummary ON CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID = BIS2_SQLTC_PlayerSummary.PlayerID WHERE ((CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S') AND (BIS2_SQLTC_PlayerSummary.Visits = 2)) GROUP BY CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate/* End: BIS2_SQLTC_RatedMetrics*/) AS BIS2_SQLTC_RatedMetrics INNER JOIN (/* SqlTableCalculator: BIS2_SQLTC_UnratedMetrics*/SELECT CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AS Mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.Mnum_Location AS Mnum_Location,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AS SiteID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid AS StandID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AS startdate,case when count(distinct cast(bis2_vw_perioddetail.standid as varchar)+cast( dbo.BIS2_VW_PeriodDetail.date as varchar))<>0 then sum(BIS2_VW_PeriodDetail.MtrGames)/count(distinct cast(bis2_vw_perioddetail.standid as varchar)+cast( dbo.BIS2_VW_PeriodDetail.date as varchar))else 0 END AS GamesPlayedperDay FROM CRMDemo.dbo.BIS2_VW_PeriodDetail INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PeriodDetail.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID INNER JOIN CRMDemo.dbo.BIS2_V_Slot_Location_SCD ON (CRMDemo.dbo.BIS2_VW_PeriodDetail.SiteID = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PeriodDetail.Mnum = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AND CRMDemo.dbo.BIS2_VW_PeriodDetail.Date >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AND CRMDemo.dbo.BIS2_VW_PeriodDetail.Date < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate) WHERE ((CRMDemo.dbo.BIS2_VW_PeriodDetail.Date >= '20130201') AND (CRMDemo.dbo.BIS2_VW_PeriodDetail.Date < '20130214') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB')) GROUP BY CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.Mnum_Location,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate/* End: BIS2_SQLTC_UnratedMetrics*/) AS BIS2_SQLTC_UnratedMetrics ON (BIS2_SQLTC_RatedMetrics.SiteID = BIS2_SQLTC_UnratedMetrics.SiteID AND BIS2_SQLTC_RatedMetrics.Mnum = BIS2_SQLTC_UnratedMetrics.Mnum AND BIS2_SQLTC_RatedMetrics.StandID = BIS2_SQLTC_UnratedMetrics.StandID AND BIS2_SQLTC_RatedMetrics.startdate = BIS2_SQLTC_UnratedMetrics.startdate)/* End: BIS2_SQLTC_Occupancy*/) AS BIS2_SQLTC_Occupancy ON (CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid = BIS2_SQLTC_Occupancy.SiteID AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum = BIS2_SQLTC_Occupancy.Mnum AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid = BIS2_SQLTC_Occupancy.StandID AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate = BIS2_SQLTC_Occupancy.startdate) ", 'CRMDemo.dbo.BIS2_VW_Slot_Names': 'LEFT JOIN CRMDemo.dbo.BIS2_VW_Slot_Names ON (CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid = CRMDemo.dbo.BIS2_VW_Slot_Names.SiteID AND CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.mnum = CRMDemo.dbo.BIS2_VW_Slot_Names.mnum) ', 'CRMDemo.dbo.BIS2_V_Slot_Location_SCD': 'INNER JOIN CRMDemo.dbo.BIS2_V_Slot_Location_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.MNUM = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate) ', 'BIS2_SQLTC_PlayerSummary': "INNER HASH JOIN (/* SqlTableCalculator: BIS2_SQLTC_PlayerSummary*/SELECT MAX(BIS2_VW_PlayerSession.GamingDate) AS LastDaywithPlay,CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID AS PlayerID,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN 100.0*SUM(BIS2_VW_PlayerSession.Win)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS ActualWinTheoWinRatio,Case WHEN count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) <> 0 THEN  sum(BIS2_VW_PlayerSession.TheoWin)/count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) ELSE 0 END AS ADT,Sum(BIS2_VW_PlayerSession.TheoWin)/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMT,cast(count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) as decimal(10,4))/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMV,datediff(dd,max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),MAX(BIS2_FN_SGStartEndDate.SGEndDate)) AS DaysSinceLastTrip,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN (SUM(BIS2_VW_PlayerSession.Freeplay)*100.0)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS FreeplayReinvestmentPct,CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then  datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end AS MeanTimeBetweenTrips,CASE WHEN SUM(case when GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)<>0 THEN (100.0*(SUM(case when   GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)-SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)))/SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END) ELSE 0 END AS PercentChangeTheoWin,CASE WHEN COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)<>0 THEN   (100.0*(COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)-   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)))/   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END) ELSE 0 END AS PercentChangeVisits,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin,CASE WHEN CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end <>0 THEN  datediff(dd,  max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),  MAX(BIS2_FN_SGStartEndDate.SGEndDate))/CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end ELSE 0 END AS TripsOwed,case when cast(DATEDIFF(dd,max(BIS2_VW_PlayerSession.GamingDate),min(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2)) <> 0 then  (count(distinct BIS2_VW_PlayerSession.GamingDate)-1)/cast(DATEDIFF(dd,min(BIS2_VW_PlayerSession.GamingDate),max(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2))  ELSE 0 END AS VisitDensity,count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) AS Visits FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_FN_SGStartEndDate('20130201 00:00:00','20130214 00:00:00') AS BIS2_FN_SGStartEndDate ON CRMDemo.dbo.BIS2_VW_PlayerSession.hackjoin = BIS2_FN_SGStartEndDate.HackJoin INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID WHERE ((CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')) GROUP BY CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID/* End: BIS2_SQLTC_PlayerSummary*/) AS BIS2_SQLTC_PlayerSummary ON CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID = BIS2_SQLTC_PlayerSummary.PlayerID ", 'CRMDemo.dbo.BIS2_GEO_chairs': 'INNER JOIN CRMDemo.dbo.BIS2_GEO_chairs ON (CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid = CRMDemo.dbo.BIS2_GEO_chairs.standid AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid = CRMDemo.dbo.BIS2_GEO_chairs.casinoid) ', 'CRMDemo.dbo.BIS2_VW_Game_Comb_SCD': 'INNER HASH JOIN CRMDemo.dbo.BIS2_VW_Game_Comb_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.Location = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.standid) ', 'CRMDemo.dbo.BIS2_VW_PlayerSession': 'FROM CRMDemo.dbo.BIS2_VW_PlayerSession '}
	DocWhere: ["(CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00') ", "(CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00') ", "(CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131') ", "(CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215') ", "(CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') ", "(CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S') ", '(BIS2_SQLTC_PlayerSummary.Visits = 2) ', '(CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_GEO_chairs.startgd) ', '(CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_GEO_chairs.endgd) ', '(CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate) ', '(CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate)']
	DocWhereAnd: {"(CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S') ": 'AND ', '(BIS2_SQLTC_PlayerSummary.Visits = 2) ': 'AND ', '(CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_GEO_chairs.startgd) ': 'AND ', "(CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00') ": 'start', "(CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00') ": 'AND ', "(CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131') ": 'AND ', '(CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate)': 'AND ', '(CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate) ': 'AND ', "(CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215') ": 'AND ', "(CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') ": 'AND ', '(CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_GEO_chairs.endgd) ': 'AND '}
2016-10-01 14:49:52.384490: Final data about 36e420872-14e9e7e47e8:
	UserAggList: ['ActualWin', 'CoinIn', 'TheoWin']
	UserRestrictList: ["(CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') ", "(CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S') ", '(BIS2_SQLTC_PlayerSummary.Visits = 2) ']
	FinalQuery: SELECT 'Step 1' AS Step, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.CoinIn) AS CoinIn, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin, 'CRMDemo.dbo.BIS2_VW_PlayerSession' AS StepInfo FROM CRMDemo.dbo.BIS2_VW_PlayerSession WHERE (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215')  UNION ALL SELECT 'Step 1B' AS Step, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.CoinIn) AS CoinIn, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin, 'CRMDemo.dbo.BIS2_VW_PlayerSession (Restriction)' AS StepInfo FROM CRMDemo.dbo.BIS2_VW_PlayerSession WHERE (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')  UNION ALL SELECT 'Step 2' AS Step, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.CoinIn) AS CoinIn, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin, 'CRMDemo.dbo.BIS2_VW_Game_Comb_SCD' AS StepInfo FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_VW_Game_Comb_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.Location = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.standid) WHERE (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')  UNION ALL SELECT 'Step 3' AS Step, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.CoinIn) AS CoinIn, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin, 'CRMDemo.dbo.BIS2_VW_Slot_Names' AS StepInfo FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_VW_Game_Comb_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.Location = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.standid) LEFT JOIN CRMDemo.dbo.BIS2_VW_Slot_Names ON (CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid = CRMDemo.dbo.BIS2_VW_Slot_Names.SiteID AND CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.mnum = CRMDemo.dbo.BIS2_VW_Slot_Names.mnum) WHERE (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')  UNION ALL SELECT 'Step 4' AS Step, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.CoinIn) AS CoinIn, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin, 'CRMDemo.dbo.BIS2_VW_Site' AS StepInfo FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_VW_Game_Comb_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.Location = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.standid) LEFT JOIN CRMDemo.dbo.BIS2_VW_Slot_Names ON (CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid = CRMDemo.dbo.BIS2_VW_Slot_Names.SiteID AND CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.mnum = CRMDemo.dbo.BIS2_VW_Slot_Names.mnum) INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID WHERE (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')  UNION ALL SELECT 'Step 4B' AS Step, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.CoinIn) AS CoinIn, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin, 'CRMDemo.dbo.BIS2_VW_Site (Restriction)' AS StepInfo FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_VW_Game_Comb_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.Location = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.standid) LEFT JOIN CRMDemo.dbo.BIS2_VW_Slot_Names ON (CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid = CRMDemo.dbo.BIS2_VW_Slot_Names.SiteID AND CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.mnum = CRMDemo.dbo.BIS2_VW_Slot_Names.mnum) INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID WHERE (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')  AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB')  UNION ALL SELECT 'Step 5' AS Step, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.CoinIn) AS CoinIn, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin, 'CRMDemo.dbo.BIS2_V_Slot_Location_SCD' AS StepInfo FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_VW_Game_Comb_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.Location = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.standid) LEFT JOIN CRMDemo.dbo.BIS2_VW_Slot_Names ON (CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid = CRMDemo.dbo.BIS2_VW_Slot_Names.SiteID AND CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.mnum = CRMDemo.dbo.BIS2_VW_Slot_Names.mnum) INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID INNER JOIN CRMDemo.dbo.BIS2_V_Slot_Location_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.MNUM = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate) WHERE (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')  AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB')  UNION ALL SELECT 'Step 6' AS Step, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.CoinIn) AS CoinIn, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin, 'CRMDemo.dbo.BIS2_GEO_chairs' AS StepInfo FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_VW_Game_Comb_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.Location = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.standid) LEFT JOIN CRMDemo.dbo.BIS2_VW_Slot_Names ON (CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid = CRMDemo.dbo.BIS2_VW_Slot_Names.SiteID AND CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.mnum = CRMDemo.dbo.BIS2_VW_Slot_Names.mnum) INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID INNER JOIN CRMDemo.dbo.BIS2_V_Slot_Location_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.MNUM = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate) INNER JOIN CRMDemo.dbo.BIS2_GEO_chairs ON (CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid = CRMDemo.dbo.BIS2_GEO_chairs.standid AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid = CRMDemo.dbo.BIS2_GEO_chairs.casinoid) WHERE (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')  AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB')  UNION ALL SELECT 'Step 7' AS Step, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.CoinIn) AS CoinIn, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin, 'BIS2_SQLTC_Occupancy' AS StepInfo FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_VW_Game_Comb_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.Location = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.standid) LEFT JOIN CRMDemo.dbo.BIS2_VW_Slot_Names ON (CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid = CRMDemo.dbo.BIS2_VW_Slot_Names.SiteID AND CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.mnum = CRMDemo.dbo.BIS2_VW_Slot_Names.mnum) INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID INNER JOIN CRMDemo.dbo.BIS2_V_Slot_Location_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.MNUM = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate) INNER JOIN CRMDemo.dbo.BIS2_GEO_chairs ON (CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid = CRMDemo.dbo.BIS2_GEO_chairs.standid AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid = CRMDemo.dbo.BIS2_GEO_chairs.casinoid) INNER JOIN (/* SqlTableCalculator: BIS2_SQLTC_Occupancy*/SELECT BIS2_SQLTC_RatedMetrics.Mnum AS Mnum,BIS2_SQLTC_UnratedMetrics.Mnum_Location AS Mnum_Location,BIS2_SQLTC_RatedMetrics.SiteID AS SiteID,BIS2_SQLTC_RatedMetrics.StandID AS StandID,BIS2_SQLTC_RatedMetrics.startdate AS startdate,BIS2_SQLTC_RatedMetrics.GamesPlayedPerMinute AS GamesPlayedPerMinute,CASE WHEN BIS2_SQLTC_RatedMetrics.GamesPlayedperHour/24.0 <> 0 THEN   100.0*BIS2_SQLTC_UnRatedMetrics.GamesPlayedperDay/BIS2_SQLTC_RatedMetrics.GamesPlayedperHour/24.0 ELSE 0 END AS Occupancy,BIS2_SQLTC_RatedMetrics.TheoWinperHour AS TheoWinperHour FROM (/* SqlTableCalculator: BIS2_SQLTC_RatedMetrics*/SELECT CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AS Mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AS SiteID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid AS StandID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AS startdate,CASE WHEN SUM(BIS2_VW_PlayerSession.TimePlayed/3600.0) <> 0 THEN  SUM(BIS2_VW_PlayerSession.Games)/(SUM(BIS2_VW_PlayerSession.TimePlayed/3600.0)) ELSE 0 END AS GamesPlayedPerHour,CASE WHEN SUM(BIS2_VW_PlayerSession.TimePlayed/60.0) <> 0 THEN  SUM(BIS2_VW_PlayerSession.Games)/(SUM(BIS2_VW_PlayerSession.TimePlayed/60.0)) ELSE 0 END AS GamesPlayedPerMinute,COUNT(DISTINCT BIS2_VW_PlayerSession.PlayerID) AS PlayerCount,CASE WHEN SUM(BIS2_VW_PlayerSession.TimePlayed) <> 0 THEN SUM(BIS2_VW_PlayerSession.TheoWin) /   (SUM(BIS2_VW_PlayerSession.TimePlayed)/3600.00) ELSE 0 END AS TheoWinperHour FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID INNER JOIN CRMDemo.dbo.BIS2_V_Slot_Location_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.MNUM = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate) INNER HASH JOIN (/* SqlTableCalculator: BIS2_SQLTC_PlayerSummary*/SELECT MAX(BIS2_VW_PlayerSession.GamingDate) AS LastDaywithPlay,CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID AS PlayerID,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN 100.0*SUM(BIS2_VW_PlayerSession.Win)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS ActualWinTheoWinRatio,Case WHEN count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) <> 0 THEN  sum(BIS2_VW_PlayerSession.TheoWin)/count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) ELSE 0 END AS ADT,Sum(BIS2_VW_PlayerSession.TheoWin)/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMT,cast(count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) as decimal(10,4))/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMV,datediff(dd,max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),MAX(BIS2_FN_SGStartEndDate.SGEndDate)) AS DaysSinceLastTrip,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN (SUM(BIS2_VW_PlayerSession.Freeplay)*100.0)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS FreeplayReinvestmentPct,CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then  datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end AS MeanTimeBetweenTrips,CASE WHEN SUM(case when GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)<>0 THEN (100.0*(SUM(case when   GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)-SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)))/SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END) ELSE 0 END AS PercentChangeTheoWin,CASE WHEN COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)<>0 THEN   (100.0*(COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)-   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)))/   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END) ELSE 0 END AS PercentChangeVisits,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin,CASE WHEN CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end <>0 THEN  datediff(dd,  max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),  MAX(BIS2_FN_SGStartEndDate.SGEndDate))/CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end ELSE 0 END AS TripsOwed,case when cast(DATEDIFF(dd,max(BIS2_VW_PlayerSession.GamingDate),min(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2)) <> 0 then  (count(distinct BIS2_VW_PlayerSession.GamingDate)-1)/cast(DATEDIFF(dd,min(BIS2_VW_PlayerSession.GamingDate),max(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2))  ELSE 0 END AS VisitDensity,count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) AS Visits FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_FN_SGStartEndDate('20130201 00:00:00','20130214 00:00:00') AS BIS2_FN_SGStartEndDate ON CRMDemo.dbo.BIS2_VW_PlayerSession.hackjoin = BIS2_FN_SGStartEndDate.HackJoin INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID WHERE ((CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')) GROUP BY CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID/* End: BIS2_SQLTC_PlayerSummary*/) AS BIS2_SQLTC_PlayerSummary ON CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID = BIS2_SQLTC_PlayerSummary.PlayerID WHERE ((CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S') AND (BIS2_SQLTC_PlayerSummary.Visits = 2)) GROUP BY CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate/* End: BIS2_SQLTC_RatedMetrics*/) AS BIS2_SQLTC_RatedMetrics INNER JOIN (/* SqlTableCalculator: BIS2_SQLTC_UnratedMetrics*/SELECT CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AS Mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.Mnum_Location AS Mnum_Location,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AS SiteID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid AS StandID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AS startdate,case when count(distinct cast(bis2_vw_perioddetail.standid as varchar)+cast( dbo.BIS2_VW_PeriodDetail.date as varchar))<>0 then sum(BIS2_VW_PeriodDetail.MtrGames)/count(distinct cast(bis2_vw_perioddetail.standid as varchar)+cast( dbo.BIS2_VW_PeriodDetail.date as varchar))else 0 END AS GamesPlayedperDay FROM CRMDemo.dbo.BIS2_VW_PeriodDetail INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PeriodDetail.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID INNER JOIN CRMDemo.dbo.BIS2_V_Slot_Location_SCD ON (CRMDemo.dbo.BIS2_VW_PeriodDetail.SiteID = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PeriodDetail.Mnum = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AND CRMDemo.dbo.BIS2_VW_PeriodDetail.Date >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AND CRMDemo.dbo.BIS2_VW_PeriodDetail.Date < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate) WHERE ((CRMDemo.dbo.BIS2_VW_PeriodDetail.Date >= '20130201') AND (CRMDemo.dbo.BIS2_VW_PeriodDetail.Date < '20130214') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB')) GROUP BY CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.Mnum_Location,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate/* End: BIS2_SQLTC_UnratedMetrics*/) AS BIS2_SQLTC_UnratedMetrics ON (BIS2_SQLTC_RatedMetrics.SiteID = BIS2_SQLTC_UnratedMetrics.SiteID AND BIS2_SQLTC_RatedMetrics.Mnum = BIS2_SQLTC_UnratedMetrics.Mnum AND BIS2_SQLTC_RatedMetrics.StandID = BIS2_SQLTC_UnratedMetrics.StandID AND BIS2_SQLTC_RatedMetrics.startdate = BIS2_SQLTC_UnratedMetrics.startdate)/* End: BIS2_SQLTC_Occupancy*/) AS BIS2_SQLTC_Occupancy ON (CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid = BIS2_SQLTC_Occupancy.SiteID AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum = BIS2_SQLTC_Occupancy.Mnum AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid = BIS2_SQLTC_Occupancy.StandID AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate = BIS2_SQLTC_Occupancy.startdate) WHERE (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')  AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB')  UNION ALL SELECT 'Step 8' AS Step, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.CoinIn) AS CoinIn, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin, 'BIS2_SQLTC_PlayerSummary' AS StepInfo FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_VW_Game_Comb_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.Location = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.standid) LEFT JOIN CRMDemo.dbo.BIS2_VW_Slot_Names ON (CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid = CRMDemo.dbo.BIS2_VW_Slot_Names.SiteID AND CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.mnum = CRMDemo.dbo.BIS2_VW_Slot_Names.mnum) INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID INNER JOIN CRMDemo.dbo.BIS2_V_Slot_Location_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.MNUM = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate) INNER JOIN CRMDemo.dbo.BIS2_GEO_chairs ON (CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid = CRMDemo.dbo.BIS2_GEO_chairs.standid AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid = CRMDemo.dbo.BIS2_GEO_chairs.casinoid) INNER JOIN (/* SqlTableCalculator: BIS2_SQLTC_Occupancy*/SELECT BIS2_SQLTC_RatedMetrics.Mnum AS Mnum,BIS2_SQLTC_UnratedMetrics.Mnum_Location AS Mnum_Location,BIS2_SQLTC_RatedMetrics.SiteID AS SiteID,BIS2_SQLTC_RatedMetrics.StandID AS StandID,BIS2_SQLTC_RatedMetrics.startdate AS startdate,BIS2_SQLTC_RatedMetrics.GamesPlayedPerMinute AS GamesPlayedPerMinute,CASE WHEN BIS2_SQLTC_RatedMetrics.GamesPlayedperHour/24.0 <> 0 THEN   100.0*BIS2_SQLTC_UnRatedMetrics.GamesPlayedperDay/BIS2_SQLTC_RatedMetrics.GamesPlayedperHour/24.0 ELSE 0 END AS Occupancy,BIS2_SQLTC_RatedMetrics.TheoWinperHour AS TheoWinperHour FROM (/* SqlTableCalculator: BIS2_SQLTC_RatedMetrics*/SELECT CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AS Mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AS SiteID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid AS StandID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AS startdate,CASE WHEN SUM(BIS2_VW_PlayerSession.TimePlayed/3600.0) <> 0 THEN  SUM(BIS2_VW_PlayerSession.Games)/(SUM(BIS2_VW_PlayerSession.TimePlayed/3600.0)) ELSE 0 END AS GamesPlayedPerHour,CASE WHEN SUM(BIS2_VW_PlayerSession.TimePlayed/60.0) <> 0 THEN  SUM(BIS2_VW_PlayerSession.Games)/(SUM(BIS2_VW_PlayerSession.TimePlayed/60.0)) ELSE 0 END AS GamesPlayedPerMinute,COUNT(DISTINCT BIS2_VW_PlayerSession.PlayerID) AS PlayerCount,CASE WHEN SUM(BIS2_VW_PlayerSession.TimePlayed) <> 0 THEN SUM(BIS2_VW_PlayerSession.TheoWin) /   (SUM(BIS2_VW_PlayerSession.TimePlayed)/3600.00) ELSE 0 END AS TheoWinperHour FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID INNER JOIN CRMDemo.dbo.BIS2_V_Slot_Location_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.MNUM = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate) INNER HASH JOIN (/* SqlTableCalculator: BIS2_SQLTC_PlayerSummary*/SELECT MAX(BIS2_VW_PlayerSession.GamingDate) AS LastDaywithPlay,CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID AS PlayerID,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN 100.0*SUM(BIS2_VW_PlayerSession.Win)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS ActualWinTheoWinRatio,Case WHEN count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) <> 0 THEN  sum(BIS2_VW_PlayerSession.TheoWin)/count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) ELSE 0 END AS ADT,Sum(BIS2_VW_PlayerSession.TheoWin)/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMT,cast(count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) as decimal(10,4))/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMV,datediff(dd,max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),MAX(BIS2_FN_SGStartEndDate.SGEndDate)) AS DaysSinceLastTrip,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN (SUM(BIS2_VW_PlayerSession.Freeplay)*100.0)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS FreeplayReinvestmentPct,CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then  datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end AS MeanTimeBetweenTrips,CASE WHEN SUM(case when GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)<>0 THEN (100.0*(SUM(case when   GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)-SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)))/SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END) ELSE 0 END AS PercentChangeTheoWin,CASE WHEN COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)<>0 THEN   (100.0*(COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)-   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)))/   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END) ELSE 0 END AS PercentChangeVisits,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin,CASE WHEN CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end <>0 THEN  datediff(dd,  max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),  MAX(BIS2_FN_SGStartEndDate.SGEndDate))/CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end ELSE 0 END AS TripsOwed,case when cast(DATEDIFF(dd,max(BIS2_VW_PlayerSession.GamingDate),min(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2)) <> 0 then  (count(distinct BIS2_VW_PlayerSession.GamingDate)-1)/cast(DATEDIFF(dd,min(BIS2_VW_PlayerSession.GamingDate),max(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2))  ELSE 0 END AS VisitDensity,count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) AS Visits FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_FN_SGStartEndDate('20130201 00:00:00','20130214 00:00:00') AS BIS2_FN_SGStartEndDate ON CRMDemo.dbo.BIS2_VW_PlayerSession.hackjoin = BIS2_FN_SGStartEndDate.HackJoin INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID WHERE ((CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')) GROUP BY CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID/* End: BIS2_SQLTC_PlayerSummary*/) AS BIS2_SQLTC_PlayerSummary ON CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID = BIS2_SQLTC_PlayerSummary.PlayerID WHERE ((CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S') AND (BIS2_SQLTC_PlayerSummary.Visits = 2)) GROUP BY CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate/* End: BIS2_SQLTC_RatedMetrics*/) AS BIS2_SQLTC_RatedMetrics INNER JOIN (/* SqlTableCalculator: BIS2_SQLTC_UnratedMetrics*/SELECT CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AS Mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.Mnum_Location AS Mnum_Location,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AS SiteID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid AS StandID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AS startdate,case when count(distinct cast(bis2_vw_perioddetail.standid as varchar)+cast( dbo.BIS2_VW_PeriodDetail.date as varchar))<>0 then sum(BIS2_VW_PeriodDetail.MtrGames)/count(distinct cast(bis2_vw_perioddetail.standid as varchar)+cast( dbo.BIS2_VW_PeriodDetail.date as varchar))else 0 END AS GamesPlayedperDay FROM CRMDemo.dbo.BIS2_VW_PeriodDetail INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PeriodDetail.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID INNER JOIN CRMDemo.dbo.BIS2_V_Slot_Location_SCD ON (CRMDemo.dbo.BIS2_VW_PeriodDetail.SiteID = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PeriodDetail.Mnum = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AND CRMDemo.dbo.BIS2_VW_PeriodDetail.Date >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AND CRMDemo.dbo.BIS2_VW_PeriodDetail.Date < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate) WHERE ((CRMDemo.dbo.BIS2_VW_PeriodDetail.Date >= '20130201') AND (CRMDemo.dbo.BIS2_VW_PeriodDetail.Date < '20130214') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB')) GROUP BY CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.Mnum_Location,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate/* End: BIS2_SQLTC_UnratedMetrics*/) AS BIS2_SQLTC_UnratedMetrics ON (BIS2_SQLTC_RatedMetrics.SiteID = BIS2_SQLTC_UnratedMetrics.SiteID AND BIS2_SQLTC_RatedMetrics.Mnum = BIS2_SQLTC_UnratedMetrics.Mnum AND BIS2_SQLTC_RatedMetrics.StandID = BIS2_SQLTC_UnratedMetrics.StandID AND BIS2_SQLTC_RatedMetrics.startdate = BIS2_SQLTC_UnratedMetrics.startdate)/* End: BIS2_SQLTC_Occupancy*/) AS BIS2_SQLTC_Occupancy ON (CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid = BIS2_SQLTC_Occupancy.SiteID AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum = BIS2_SQLTC_Occupancy.Mnum AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid = BIS2_SQLTC_Occupancy.StandID AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate = BIS2_SQLTC_Occupancy.startdate) INNER HASH JOIN (/* SqlTableCalculator: BIS2_SQLTC_PlayerSummary*/SELECT MAX(BIS2_VW_PlayerSession.GamingDate) AS LastDaywithPlay,CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID AS PlayerID,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN 100.0*SUM(BIS2_VW_PlayerSession.Win)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS ActualWinTheoWinRatio,Case WHEN count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) <> 0 THEN  sum(BIS2_VW_PlayerSession.TheoWin)/count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) ELSE 0 END AS ADT,Sum(BIS2_VW_PlayerSession.TheoWin)/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMT,cast(count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) as decimal(10,4))/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMV,datediff(dd,max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),MAX(BIS2_FN_SGStartEndDate.SGEndDate)) AS DaysSinceLastTrip,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN (SUM(BIS2_VW_PlayerSession.Freeplay)*100.0)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS FreeplayReinvestmentPct,CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then  datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end AS MeanTimeBetweenTrips,CASE WHEN SUM(case when GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)<>0 THEN (100.0*(SUM(case when   GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)-SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)))/SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END) ELSE 0 END AS PercentChangeTheoWin,CASE WHEN COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)<>0 THEN   (100.0*(COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)-   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)))/   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END) ELSE 0 END AS PercentChangeVisits,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin,CASE WHEN CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end <>0 THEN  datediff(dd,  max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),  MAX(BIS2_FN_SGStartEndDate.SGEndDate))/CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end ELSE 0 END AS TripsOwed,case when cast(DATEDIFF(dd,max(BIS2_VW_PlayerSession.GamingDate),min(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2)) <> 0 then  (count(distinct BIS2_VW_PlayerSession.GamingDate)-1)/cast(DATEDIFF(dd,min(BIS2_VW_PlayerSession.GamingDate),max(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2))  ELSE 0 END AS VisitDensity,count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) AS Visits FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_FN_SGStartEndDate('20130201 00:00:00','20130214 00:00:00') AS BIS2_FN_SGStartEndDate ON CRMDemo.dbo.BIS2_VW_PlayerSession.hackjoin = BIS2_FN_SGStartEndDate.HackJoin INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID WHERE ((CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')) GROUP BY CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID/* End: BIS2_SQLTC_PlayerSummary*/) AS BIS2_SQLTC_PlayerSummary ON CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID = BIS2_SQLTC_PlayerSummary.PlayerID WHERE (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')  AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB')  UNION ALL SELECT 'Step 8B' AS Step, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.CoinIn) AS CoinIn, SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin, 'BIS2_SQLTC_PlayerSummary (Restriction)' AS StepInfo FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_VW_Game_Comb_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.Location = CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.standid) LEFT JOIN CRMDemo.dbo.BIS2_VW_Slot_Names ON (CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.siteid = CRMDemo.dbo.BIS2_VW_Slot_Names.SiteID AND CRMDemo.dbo.BIS2_VW_Game_Comb_SCD.mnum = CRMDemo.dbo.BIS2_VW_Slot_Names.mnum) INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID INNER JOIN CRMDemo.dbo.BIS2_V_Slot_Location_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.MNUM = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate) INNER JOIN CRMDemo.dbo.BIS2_GEO_chairs ON (CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid = CRMDemo.dbo.BIS2_GEO_chairs.standid AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid = CRMDemo.dbo.BIS2_GEO_chairs.casinoid) INNER JOIN (/* SqlTableCalculator: BIS2_SQLTC_Occupancy*/SELECT BIS2_SQLTC_RatedMetrics.Mnum AS Mnum,BIS2_SQLTC_UnratedMetrics.Mnum_Location AS Mnum_Location,BIS2_SQLTC_RatedMetrics.SiteID AS SiteID,BIS2_SQLTC_RatedMetrics.StandID AS StandID,BIS2_SQLTC_RatedMetrics.startdate AS startdate,BIS2_SQLTC_RatedMetrics.GamesPlayedPerMinute AS GamesPlayedPerMinute,CASE WHEN BIS2_SQLTC_RatedMetrics.GamesPlayedperHour/24.0 <> 0 THEN   100.0*BIS2_SQLTC_UnRatedMetrics.GamesPlayedperDay/BIS2_SQLTC_RatedMetrics.GamesPlayedperHour/24.0 ELSE 0 END AS Occupancy,BIS2_SQLTC_RatedMetrics.TheoWinperHour AS TheoWinperHour FROM (/* SqlTableCalculator: BIS2_SQLTC_RatedMetrics*/SELECT CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AS Mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AS SiteID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid AS StandID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AS startdate,CASE WHEN SUM(BIS2_VW_PlayerSession.TimePlayed/3600.0) <> 0 THEN  SUM(BIS2_VW_PlayerSession.Games)/(SUM(BIS2_VW_PlayerSession.TimePlayed/3600.0)) ELSE 0 END AS GamesPlayedPerHour,CASE WHEN SUM(BIS2_VW_PlayerSession.TimePlayed/60.0) <> 0 THEN  SUM(BIS2_VW_PlayerSession.Games)/(SUM(BIS2_VW_PlayerSession.TimePlayed/60.0)) ELSE 0 END AS GamesPlayedPerMinute,COUNT(DISTINCT BIS2_VW_PlayerSession.PlayerID) AS PlayerCount,CASE WHEN SUM(BIS2_VW_PlayerSession.TimePlayed) <> 0 THEN SUM(BIS2_VW_PlayerSession.TheoWin) /   (SUM(BIS2_VW_PlayerSession.TimePlayed)/3600.00) ELSE 0 END AS TheoWinperHour FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID INNER JOIN CRMDemo.dbo.BIS2_V_Slot_Location_SCD ON (CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PlayerSession.MNUM = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AND CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate) INNER HASH JOIN (/* SqlTableCalculator: BIS2_SQLTC_PlayerSummary*/SELECT MAX(BIS2_VW_PlayerSession.GamingDate) AS LastDaywithPlay,CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID AS PlayerID,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN 100.0*SUM(BIS2_VW_PlayerSession.Win)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS ActualWinTheoWinRatio,Case WHEN count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) <> 0 THEN  sum(BIS2_VW_PlayerSession.TheoWin)/count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) ELSE 0 END AS ADT,Sum(BIS2_VW_PlayerSession.TheoWin)/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMT,cast(count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) as decimal(10,4))/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMV,datediff(dd,max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),MAX(BIS2_FN_SGStartEndDate.SGEndDate)) AS DaysSinceLastTrip,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN (SUM(BIS2_VW_PlayerSession.Freeplay)*100.0)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS FreeplayReinvestmentPct,CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then  datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end AS MeanTimeBetweenTrips,CASE WHEN SUM(case when GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)<>0 THEN (100.0*(SUM(case when   GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)-SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)))/SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END) ELSE 0 END AS PercentChangeTheoWin,CASE WHEN COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)<>0 THEN   (100.0*(COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)-   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)))/   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END) ELSE 0 END AS PercentChangeVisits,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin,CASE WHEN CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end <>0 THEN  datediff(dd,  max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),  MAX(BIS2_FN_SGStartEndDate.SGEndDate))/CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end ELSE 0 END AS TripsOwed,case when cast(DATEDIFF(dd,max(BIS2_VW_PlayerSession.GamingDate),min(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2)) <> 0 then  (count(distinct BIS2_VW_PlayerSession.GamingDate)-1)/cast(DATEDIFF(dd,min(BIS2_VW_PlayerSession.GamingDate),max(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2))  ELSE 0 END AS VisitDensity,count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) AS Visits FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_FN_SGStartEndDate('20130201 00:00:00','20130214 00:00:00') AS BIS2_FN_SGStartEndDate ON CRMDemo.dbo.BIS2_VW_PlayerSession.hackjoin = BIS2_FN_SGStartEndDate.HackJoin INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID WHERE ((CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')) GROUP BY CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID/* End: BIS2_SQLTC_PlayerSummary*/) AS BIS2_SQLTC_PlayerSummary ON CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID = BIS2_SQLTC_PlayerSummary.PlayerID WHERE ((CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S') AND (BIS2_SQLTC_PlayerSummary.Visits = 2)) GROUP BY CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate/* End: BIS2_SQLTC_RatedMetrics*/) AS BIS2_SQLTC_RatedMetrics INNER JOIN (/* SqlTableCalculator: BIS2_SQLTC_UnratedMetrics*/SELECT CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AS Mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.Mnum_Location AS Mnum_Location,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AS SiteID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid AS StandID,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AS startdate,case when count(distinct cast(bis2_vw_perioddetail.standid as varchar)+cast( dbo.BIS2_VW_PeriodDetail.date as varchar))<>0 then sum(BIS2_VW_PeriodDetail.MtrGames)/count(distinct cast(bis2_vw_perioddetail.standid as varchar)+cast( dbo.BIS2_VW_PeriodDetail.date as varchar))else 0 END AS GamesPlayedperDay FROM CRMDemo.dbo.BIS2_VW_PeriodDetail INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PeriodDetail.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID INNER JOIN CRMDemo.dbo.BIS2_V_Slot_Location_SCD ON (CRMDemo.dbo.BIS2_VW_PeriodDetail.SiteID = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid AND CRMDemo.dbo.BIS2_VW_PeriodDetail.Mnum = CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum AND CRMDemo.dbo.BIS2_VW_PeriodDetail.Date >= CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate AND CRMDemo.dbo.BIS2_VW_PeriodDetail.Date < CRMDemo.dbo.BIS2_V_Slot_Location_SCD.enddate) WHERE ((CRMDemo.dbo.BIS2_VW_PeriodDetail.Date >= '20130201') AND (CRMDemo.dbo.BIS2_VW_PeriodDetail.Date < '20130214') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB')) GROUP BY CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.Mnum_Location,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid,CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate/* End: BIS2_SQLTC_UnratedMetrics*/) AS BIS2_SQLTC_UnratedMetrics ON (BIS2_SQLTC_RatedMetrics.SiteID = BIS2_SQLTC_UnratedMetrics.SiteID AND BIS2_SQLTC_RatedMetrics.Mnum = BIS2_SQLTC_UnratedMetrics.Mnum AND BIS2_SQLTC_RatedMetrics.StandID = BIS2_SQLTC_UnratedMetrics.StandID AND BIS2_SQLTC_RatedMetrics.startdate = BIS2_SQLTC_UnratedMetrics.startdate)/* End: BIS2_SQLTC_Occupancy*/) AS BIS2_SQLTC_Occupancy ON (CRMDemo.dbo.BIS2_V_Slot_Location_SCD.siteid = BIS2_SQLTC_Occupancy.SiteID AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.mnum = BIS2_SQLTC_Occupancy.Mnum AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.standid = BIS2_SQLTC_Occupancy.StandID AND CRMDemo.dbo.BIS2_V_Slot_Location_SCD.startdate = BIS2_SQLTC_Occupancy.startdate) INNER HASH JOIN (/* SqlTableCalculator: BIS2_SQLTC_PlayerSummary*/SELECT MAX(BIS2_VW_PlayerSession.GamingDate) AS LastDaywithPlay,CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID AS PlayerID,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.Win) AS ActualWin,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN 100.0*SUM(BIS2_VW_PlayerSession.Win)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS ActualWinTheoWinRatio,Case WHEN count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) <> 0 THEN  sum(BIS2_VW_PlayerSession.TheoWin)/count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) ELSE 0 END AS ADT,Sum(BIS2_VW_PlayerSession.TheoWin)/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMT,cast(count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) as decimal(10,4))/cast(Count(distinct cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(datepart(mm, BIS2_VW_PlayerSession.GamingDate) AS varchar(2)) + cast(datepart(yy, BIS2_VW_PlayerSession.GamingDate) AS varchar(2))) as decimal(10,2)) AS AMV,datediff(dd,max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),MAX(BIS2_FN_SGStartEndDate.SGEndDate)) AS DaysSinceLastTrip,CASE WHEN SUM(BIS2_VW_PlayerSession.TheoWin)<>0 THEN (SUM(BIS2_VW_PlayerSession.Freeplay)*100.0)/SUM(BIS2_VW_PlayerSession.TheoWin) ELSE 0 END AS FreeplayReinvestmentPct,CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then  datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end AS MeanTimeBetweenTrips,CASE WHEN SUM(case when GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)<>0 THEN (100.0*(SUM(case when   GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)-SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END)))/SUM(case when   GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN BIS2_VW_PlayerSession.TheoWin ELSE 0 END) ELSE 0 END AS PercentChangeTheoWin,CASE WHEN COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)<>0 THEN   (100.0*(COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate>=dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)-   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END)))/   COUNT(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID as varchar)+CASE WHEN GamingDate<dateadd(day,  datediff(day,  BIS2_FN_SGStartEndDate.SGStartDate,  BIS2_FN_SGStartEndDate.SGEndDate)/2,  BIS2_FN_SGStartEndDate.SGStartDate) THEN cast(BIS2_VW_PlayerSession.GamingDate as varchar) ELSE NULL END) ELSE 0 END AS PercentChangeVisits,SUM(CRMDemo.dbo.BIS2_VW_PlayerSession.TheoWin) AS TheoWin,CASE WHEN CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end <>0 THEN  datediff(dd,  max(cast(BIS2_VW_PlayerSession.GamingDate as varchar)),  MAX(BIS2_FN_SGStartEndDate.SGEndDate))/CASE when count(distinct BIS2_VW_PlayerSession.GamingDate)-1 <> 0 then   datediff(dd,min(BIS2_VW_PlayerSession.GamingDate), max(BIS2_VW_PlayerSession.GamingDate))/cast((count(distinct BIS2_VW_PlayerSession.GamingDate))-1 as decimal(15,2)) ELSE 0 end ELSE 0 END AS TripsOwed,case when cast(DATEDIFF(dd,max(BIS2_VW_PlayerSession.GamingDate),min(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2)) <> 0 then  (count(distinct BIS2_VW_PlayerSession.GamingDate)-1)/cast(DATEDIFF(dd,min(BIS2_VW_PlayerSession.GamingDate),max(BIS2_VW_PlayerSession.GamingDate)) as decimal(15,2))  ELSE 0 END AS VisitDensity,count(DISTINCT cast(BIS2_VW_PlayerSession.PlayerID AS varchar)+cast(BIS2_VW_PlayerSession.GamingDate as varchar)) AS Visits FROM CRMDemo.dbo.BIS2_VW_PlayerSession INNER HASH JOIN CRMDemo.dbo.BIS2_FN_SGStartEndDate('20130201 00:00:00','20130214 00:00:00') AS BIS2_FN_SGStartEndDate ON CRMDemo.dbo.BIS2_VW_PlayerSession.hackjoin = BIS2_FN_SGStartEndDate.HackJoin INNER JOIN CRMDemo.dbo.BIS2_VW_Site ON CRMDemo.dbo.BIS2_VW_PlayerSession.SiteID = CRMDemo.dbo.BIS2_VW_Site.SiteID WHERE ((CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215') AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB') AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')) GROUP BY CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID/* End: BIS2_SQLTC_PlayerSummary*/) AS BIS2_SQLTC_PlayerSummary ON CRMDemo.dbo.BIS2_VW_PlayerSession.PlayerID = BIS2_SQLTC_PlayerSummary.PlayerID WHERE (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime >= '20130201 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate >= '20130131')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.EndTime < '20130214 00:00:00')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.GamingDate < '20130215')  AND (CRMDemo.dbo.BIS2_VW_PlayerSession.Type = 'S')  AND (CRMDemo.dbo.BIS2_VW_Site.SiteCode = 'IVB')  AND (BIS2_SQLTC_PlayerSummary.Visits = 2) 
2016-10-01 14:49:52.401472: Now attempting to run the query for 36e420872-14e9e7e47e8:
2016-10-01 14:49:52.414984: Attempting to connect to the database:
2016-10-01 14:49:56.171552: Database connection successful.
2016-10-01 15:20:08.776029: Query successfully run. Here are the results:
	[('Step 1', Decimal('4011509.3600'), Decimal('51003058.32'), Decimal('4179440.4042'), 'CRMDemo.dbo.BIS2_VW_PlayerSession'), ('Step 1B', Decimal('3489209.3600'), Decimal('47687092.32'), Decimal('3571271.4600'), 'CRMDemo.dbo.BIS2_VW_PlayerSession (Restriction)'), ('Step 2', Decimal('13873816.1000'), Decimal('199501481.70'), Decimal('16162488.6400'), 'CRMDemo.dbo.BIS2_VW_Game_Comb_SCD'), ('Step 3', Decimal('13873816.1000'), Decimal('199501481.70'), Decimal('16162488.6400'), 'CRMDemo.dbo.BIS2_VW_Slot_Names'), ('Step 4', Decimal('13873816.1000'), Decimal('199501481.70'), Decimal('16162488.6400'), 'CRMDemo.dbo.BIS2_VW_Site'), ('Step 4B', Decimal('6939736.7100'), Decimal('99809080.05'), Decimal('8085842.9000'), 'CRMDemo.dbo.BIS2_VW_Site (Restriction)'), ('Step 5', Decimal('2916254.6600'), Decimal('39730068.80'), Decimal('3249520.2400'), 'CRMDemo.dbo.BIS2_V_Slot_Location_SCD'), ('Step 6', Decimal('2947713.5100'), Decimal('40100720.63'), Decimal('3276598.2100'), 'CRMDemo.dbo.BIS2_GEO_chairs'), ('Step 7', Decimal('2938954.7600'), Decimal('39871429.38'), Decimal('3263142.0700'), 'BIS2_SQLTC_Occupancy'), ('Step 8', Decimal('2938954.7600'), Decimal('39871429.38'), Decimal('3263142.0700'), 'BIS2_SQLTC_PlayerSummary'), ('Step 8B', Decimal('436373.3500'), Decimal('8720010.68'), Decimal('711890.7200'), 'BIS2_SQLTC_PlayerSummary (Restriction)')]
2016-10-01 15:20:08.790533: Attempting to create the excel sheet for 36e420872-14e9e7e47e8
2016-10-01 15:20:22.153018: Excel sheet for 36e420872-14e9e7e47e8 successful.